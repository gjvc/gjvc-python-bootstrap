#! /bin/bash

# bash ----------------------------------------------------------------------------------------------

set -o errexit -o nounset -o pipefail
[[ -t 0 ]] || [[ -t 1 ]] && stty sane


# canonical path resolution -------------------------------------------------------------------------

readonly _this=$( realpath "${BASH_SOURCE[0]}" )
readonly _basename=$( basename "${_this}" )
readonly _dirname=$( dirname "${_this}" )
readonly _root=$( dirname "${_dirname}" )


# functions -----------------------------------------------------------------------------------------

source "${_dirname}/functions"


# clean ---------------------------------------------------------------------------------------------

banner "removing .pyc files"
find ${_root}/{.venv,src,lib} -name '*.pyc' -ls -delete 2>/dev/null && true

banner "removing __pycache__ directories"
find ${_root}/{.venv,src,lib} -name __pycache__ | xargs --no-run-if-empty rm -rf

if [[ "${CLEAN_ALL:-}" == "1" ]]; then
    banner "removing .pip/, .pytest/, .venv/, and tags"
    rm -rf ${_root}/{.pip/,.pytest/,.venv/,tags}
fi

