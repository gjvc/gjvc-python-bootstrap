#! /bin/bash

# bash ----------------------------------------------------------------------------------------------

set -o errexit -o nounset -o pipefail
[[ -t 0 ]] || [[ -t 1 ]] && stty sane


# location ------------------------------------------------------------------------------------------

readonly _this=$( realpath "${BASH_SOURCE[0]}" )
readonly _basename=$( basename "${_this}" )
readonly _dirname=$( dirname "${_this}" )
readonly _root=$( dirname "${_dirname}" )


# functions + settings ------------------------------------------------------------------------------

source ${_dirname}/functions
source ${_dirname}/settings


# clean install from root --------------------------------------------------------------------------

banner "recreating venv ${venv_dir}"
rm -rf "${venv_dir}"
"${python3}" -m venv "${venv_dir}"
"${_root}/bin/venv-pip3" install --requirement "${root}"
"${_root}/bin/venv-freeze"


# changes -------------------------------------------------------------------------------------------

heading "git diff ${pip_requirement_d}"
git --no-pager diff "${pip_requirement_d}" || true

